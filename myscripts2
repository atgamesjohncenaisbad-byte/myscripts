--[[
    PROJECT: STEALTH MULTIPLIER OVERRIDER
    TECHNIQUE: Upvalue Injection (Non-Hooking)
    BYPASS TARGET: Namecall Integrity Checkers
--]]

local Players = game:GetService("Players")
local lp = Players.LocalPlayer

-- Debug HUD Setup
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "InternalCombatHUD"
ScreenGui.Parent = lp:WaitForChild("PlayerGui")

local Main = Instance.new("Frame")
Main.Size = UDim2.new(0, 220, 0, 90)
Main.Position = UDim2.new(0, 10, 0.5, 0)
Main.BackgroundColor3 = Color3.fromRGB(15, 15, 15)
Main.BorderSizePixel = 0
Main.Parent = ScreenGui

local function createLabel(name, text, pos, color)
    local l = Instance.new("TextLabel")
    l.Name = name
    l.Size = UDim2.new(1, -10, 0, 20)
    l.Position = pos
    l.BackgroundTransparency = 1
    l.Font = Enum.Font.Code
    l.TextColor3 = color or Color3.new(1,1,1)
    l.TextSize = 14
    l.Text = text
    l.TextXAlignment = Enum.TextXAlignment.Left
    l.Parent = Main
    return l
end

local Title = createLabel("Title", " >> STEALTH OVERRIDER <<", UDim2.new(0, 5, 0, 5), Color3.fromRGB(255, 150, 50))
local Status = createLabel("Status", "Status: Searching...", UDim2.new(0, 5, 0, 30))
local MultiLabel = createLabel("Multi", "Multi: 1x (Idle)", UDim2.new(0, 5, 0, 55), Color3.fromRGB(100, 255, 100))

-- The "Food Chain" Logic: Upvalue Scanning
local function ApplyInternalBypass()
    local found = false
    -- getgc(true) allows us to see internal script functions
    for _, f in pairs(getgc(true)) do
        if type(f) == "function" and getfenv(f).script and getfenv(f).script.Name == "Client" then
            local info = debug.getinfo(f)
            -- We are looking for the "dealDamage" function identified in the dump
            if info.name == "dealDamage" then
                local upvals = debug.getupvalues(f)
                for i, v in pairs(upvals) do
                    -- According to the dump, var33_upvw (Multiplier) is Upvalue #10
                    -- and it defaults to the number 1 or 2.
                    if i == 10 and type(v) == "number" then
                        debug.setupvalue(f, i, 3) -- Directly inject the 3x multiplier into the script's memory
                        found = true
                        Status.Text = "Status: INJECTED (Upvalue #10)"
                        MultiLabel.Text = "Multi: 3x (ACTIVE)"
                    end
                end
            end
        end
    end
    return found
end

-- Persistence loop: If the player dies or scripts reload, re-inject immediately.
task.spawn(function()
    while true do
        local success = ApplyInternalBypass()
        if not success then
            Status.Text = "Status: Waiting for Tool..."
            Status.TextColor3 = Color3.fromRGB(200, 200, 200)
        else
            Status.TextColor3 = Color3.fromRGB(50, 255, 50)
        end
        task.wait(2) -- Scanning is light on resources, but we don't need to spam it.
    end
end)

-- Estimated Damage Calculation (Visual Only)
task.spawn(function()
    while task.wait(0.5) do
        local tool = lp.Character and lp.Character:FindFirstChildWhichIsA("Tool")
        if tool and tool:FindFirstChild("Conf") then
            local min = tool.Conf:FindFirstChild("MinDmg") and tool.Conf.MinDmg.Value or 0
            local max = tool.Conf:FindFirstChild("MaxDmg") and tool.Conf.MaxDmg.Value or 0
            Title.Text = string.format(" >> DMG: %d - %d <<", min * 3, max * 3)
        end
    end
end)
