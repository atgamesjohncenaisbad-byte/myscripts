-- Penetration Testing Script: Vulnerability #2 (Targeted DummyEvent Injection)
-- Purpose: Verify if the server validates target type and damage on a per-click basis.

local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local LocalPlayer = Players.LocalPlayer
local Mouse = LocalPlayer:GetMouse()

local DummyEvent = ReplicatedStorage:WaitForChild("DummyEvent")

-- Tamed parameters for testing
local TEST_DAMAGE = 1000 

print("Vulnerability #2 Test Active: Click a mob to attempt 1,000 damage via DummyEvent.")

Mouse.Button1Down:Connect(function()
    local targetPart = Mouse.Target
    if not targetPart then return end

    -- Find the Humanoid in the clicked model
    local character = targetPart.Parent
    local humanoid = character:FindFirstChildOfClass("Humanoid")
    
    -- If not found in Parent, check Parent.Parent (for nested parts/accessories)
    if not humanoid and character.Parent then
        character = character.Parent
        humanoid = character:FindFirstChildOfClass("Humanoid")
    end

    -- Execute the test if a valid enemy humanoid is found
    if humanoid and humanoid.Health > 0 then
        -- Ensure we aren't hitting ourselves
        if not character:IsDescendantOf(LocalPlayer.Character) then
            print("Firing DummyEvent on: " .. character.Name .. " | Damage: " .. TEST_DAMAGE)
            
            -- Direct injection: Firing the 'Dummy' remote at a non-dummy target
            DummyEvent:FireServer(TEST_DAMAGE, humanoid)
        end
    end
end)
