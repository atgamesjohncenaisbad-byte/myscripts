--[[
    ROBUST DAMAGE MODIFIER (MEMORY SURGERY METHOD)
    Target: Upvalues inside 'dealDamage' function
    Bypass: Avoids __namecall detection entirely
    Engine: Delta / Xeno / Hydrogen
]]

local CONFIG = {
    DMG_MULTIPLIER = 100, -- 100x Damage
    HITBOX_SIZE = Vector3.new(20, 20, 20), -- Range expansion
    DEBUG = true
}

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local StarterGui = game:GetService("StarterGui")
local LocalPlayer = Players.LocalPlayer

-- // 1. ROBUST ANTI-KICK (PREVENT DISCONNECTS) \\ --
local function SecureAntiKick()
    local success, err = pcall(function()
        local old_kick
        old_kick = hookfunction(LocalPlayer.Kick, newcclosure(function(self, ...)
            warn("[BLOCKED] Client attempted to Kick player.")
            return -- Do nothing
        end))
    end)
    if success then print("Anti-Kick Active") else warn("Anti-Kick Failed: " .. tostring(err)) end
end
SecureAntiKick()

-- // 2. UI FEEDBACK \\ --
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "MemorySpoofer"
ScreenGui.Parent = game:GetService("CoreGui")
local Label = Instance.new("TextLabel", ScreenGui)
Label.Size = UDim2.new(0, 250, 0, 40)
Label.Position = UDim2.new(0.5, -125, 0.1, 0)
Label.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
Label.TextColor3 = Color3.fromRGB(255, 255, 0)
Label.Text = "WAITING FOR WEAPON..."

-- // 3. THE SURGICAL LOGIC \\ --
local function ModifyWeaponLogic(tool)
    if not tool then return end
    local handle = tool:FindFirstChild("Handle")
    if not handle then return end

    -- We look for the 'Touched' event because the dump shows 'onHandleTouched' connects to it
    local connections = getconnections(handle.Touched)
    
    for _, conn in pairs(connections) do
        local func = conn.Function
        if func then
            -- We are now inside 'onHandleTouched'. 
            -- We need to find 'dealDamage' which is an upvalue of this function.
            local upvalues = debug.getupvalues(func)
            
            for i, upv in pairs(upvalues) do
                if type(upv) == "function" then
                    -- This function is likely 'dealDamage'
                    -- Now we scan THIS function's upvalues for the multiplier (number)
                    local inner_upvalues = debug.getupvalues(upv)
                    
                    for j, val in pairs(inner_upvalues) do
                        -- The dump shows the multiplier is usually 1 or 2
                        if type(val) == "number" and (val == 1 or val == 2) then
                            
                            -- OVERWRITE THE MEMORY
                            debug.setupvalue(upv, j, CONFIG.DMG_MULTIPLIER)
                            
                            if CONFIG.DEBUG then
                                Label.Text = "DMG INJECTED: " .. CONFIG.DMG_MULTIPLIER .. "x"
                                Label.TextColor3 = Color3.fromRGB(0, 255, 0)
                            end
                        end
                        
                        -- Optional: Hitbox Expansion (Vector3)
                        if type(val) == "Vector3" and CONFIG.HITBOX_SIZE then
                             -- The dump shows size is passed as an upvalue too
                             debug.setupvalue(upv, j, CONFIG.HITBOX_SIZE)
                        end
                    end
                end
            end
        end
    end
end

-- // 4. AUTOMATION LOOP \\ --
-- Automatically applies the exploit whenever you equip a new sword
LocalPlayer.CharacterAdded:Connect(function(char)
    char.ChildAdded:Connect(function(child)
        if child:IsA("Tool") then
            task.wait(0.5) -- Wait for script to load
            ModifyWeaponLogic(child)
        end
    end)
end)

-- Check current tool
if LocalPlayer.Character then
    local currentTool = LocalPlayer.Character:FindFirstChildWhichIsA("Tool")
    if currentTool then
        ModifyWeaponLogic(currentTool)
    end
end

-- Keep UI updated
task.spawn(function()
    while true do
        task.wait(1)
        if LocalPlayer.Character and LocalPlayer.Character:FindFirstChildWhichIsA("Tool") then
            -- Keep label green
        else
            Label.Text = "EQUIP SWORD TO INJECT"
            Label.TextColor3 = Color3.fromRGB(255, 255, 0)
        end
    end
end)
