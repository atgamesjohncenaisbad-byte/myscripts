--[[
    GHOST TIER DAMAGE SPOOFER
    Method: Upvalue Injection (Memory Editing)
    Bypass: No Metatable Hooks, No FireServer Hooks.
    Target: Variable 'var33_upvw' in 'dealDamage' function.
]]

local CONFIG = {
    MULTIPLIER = 100, -- Damage Multiplier (Don't go too high or server sanity checks might kill you)
    DEBUG = true
}

-- services
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local CoreGui = game:GetService("CoreGui")
local LocalPlayer = Players.LocalPlayer

-- // 1. UI SETUP (Mobile Friendly) \\ --
local function CreateUI()
    if CoreGui:FindFirstChild("GhostUI") then CoreGui.GhostUI:Destroy() end
    
    local ScreenGui = Instance.new("ScreenGui")
    ScreenGui.Name = "GhostUI"
    ScreenGui.Parent = CoreGui
    
    local Frame = Instance.new("Frame")
    Frame.Size = UDim2.new(0, 200, 0, 70)
    Frame.Position = UDim2.new(0.05, 0, 0.2, 0)
    Frame.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
    Frame.BorderSizePixel = 0
    Frame.Active = true
    Frame.Draggable = true
    Frame.Parent = ScreenGui
    
    local Title = Instance.new("TextLabel")
    Title.Text = "GHOST SPOOFER"
    Title.Size = UDim2.new(1, 0, 0, 25)
    Title.BackgroundColor3 = Color3.fromRGB(0, 170, 255)
    Title.TextColor3 = Color3.new(1,1,1)
    Title.Font = Enum.Font.GothamBold
    Title.TextSize = 14
    Title.Parent = Frame
    
    local Status = Instance.new("TextLabel")
    Status.Name = "Status"
    Status.Text = "Scanning..."
    Status.Size = UDim2.new(1, 0, 0, 45)
    Status.Position = UDim2.new(0, 0, 0, 25)
    Status.BackgroundTransparency = 1
    Status.TextColor3 = Color3.new(1, 1, 1)
    Status.Font = Enum.Font.Code
    Status.TextSize = 14
    Status.Parent = Frame
    
    return Status
end

local StatusLabel = CreateUI()

-- // 2. ANTI-KICK (Safety Net) \\ --
-- We hook Kick to print to console instead of disconnecting you.
local success, err = pcall(function()
    local old_kick
    old_kick = hookfunction(LocalPlayer.Kick, newcclosure(function(self, ...)
        warn("[GHOST] Kick attempt blocked!")
        return -- Do nothing
    end))
end)
if success then print("[GHOST] Anti-Kick Active") end

-- // 3. UPVALUE SCANNER LOGIC \\ --
local function ApplySpoof()
    local Character = LocalPlayer.Character
    if not Character then return end
    
    -- The script is usually named "Client" inside the Character model
    local ClientScript = Character:FindFirstChild("Client")
    if not ClientScript then 
        StatusLabel.Text = "Waiting for Script..."
        return 
    end

    -- We look for the RemoteEvent "SwordDamage" to identify the correct function
    local SwordDamageRemote = Character:FindFirstChild("SwordDamage")
    if not SwordDamageRemote then return end

    -- Scan Garbage Collection for the function
    for _, func in pairs(getgc()) do
        if type(func) == "function" and not is_c_closure(func) then
            local f_script = getfenv(func).script
            
            -- Verify the function belongs to the character's Client script
            if f_script == ClientScript then
                local upvalues = debug.getupvalues(func)
                
                -- IDENTIFICATION LOGIC:
                -- The 'dealDamage' function uses the 'SwordDamage' remote AND a number (multiplier)
                local hasRemote = false
                local multiplierIndex = nil
                
                for i, v in pairs(upvalues) do
                    if v == SwordDamageRemote then
                        hasRemote = true
                    elseif type(v) == "number" and (v == 1 or v == 2) then
                        -- Found the multiplier variable (usually 1, or 2 if VIP)
                        multiplierIndex = i
                    end
                end
                
                if hasRemote and multiplierIndex then
                    -- WE FOUND IT. INJECT THE VALUE.
                    debug.setupvalue(func, multiplierIndex, CONFIG.MULTIPLIER)
                    
                    StatusLabel.Text = "SPOOF ACTIVE: x" .. CONFIG.MULTIPLIER
                    StatusLabel.TextColor3 = Color3.fromRGB(0, 255, 0)
                    return true
                end
            end
        end
    end
    StatusLabel.Text = "Scanning Memory..."
    StatusLabel.TextColor3 = Color3.fromRGB(255, 255, 0)
end

-- // 4. EXECUTION LOOP \\ --
-- We run this periodically because if you die/respawn, the script resets and we need to re-inject.
task.spawn(function()
    while true do
        pcall(ApplySpoof)
        task.wait(1) -- Check every second
    end
end)
