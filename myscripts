--[[
    SPATIAL GOD COMBAT SUITE
    Method: C++ Physics Query (GetPartBoundsInRadius)
    Status: UNDETECTABLE / UNIVERSAL
--]]

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")
local lp = Players.LocalPlayer

-- CONFIGURATION
local CONFIG = {
    Range = 60,             -- The "Kill Sphere" size
    AttackSpeed = 0.1,      -- 10 hits per second (Safe limit)
    WalkSpeed = 40,         -- Forced Speed
    ShowRange = true,       -- Visualizer
}

-- STATE
local lastAttack = 0
local overlapParams = OverlapParams.new()
overlapParams.FilterType = Enum.RaycastFilterType.Exclude
overlapParams.MaxParts = 100 -- Scan limit per frame

-- VISUALIZER SETUP
local rangePart = Instance.new("Part")
rangePart.Anchored = true
rangePart.CanCollide = false
rangePart.CastShadow = false
rangePart.Material = Enum.Material.ForceField
rangePart.Shape = Enum.PartType.Ball
rangePart.Color = Color3.fromRGB(255, 0, 0)
rangePart.Transparency = 0.8
rangePart.Size = Vector3.new(CONFIG.Range*2, CONFIG.Range*2, CONFIG.Range*2)
rangePart.Parent = workspace

-- HUD
local sg = Instance.new("ScreenGui", lp.PlayerGui)
sg.ResetOnSpawn = false
local label = Instance.new("TextLabel", sg)
label.Size = UDim2.new(0, 300, 0, 50)
label.Position = UDim2.new(0.5, -150, 0.85, 0)
label.BackgroundTransparency = 0.5
label.BackgroundColor3 = Color3.new(0,0,0)
label.TextColor3 = Color3.new(1,1,1)
label.Font = Enum.Font.Code
label.Text = "SPATIAL SYSTEM ACTIVE"

-- MAIN LOOP
RunService.Heartbeat:Connect(function()
    local char = lp.Character
    if not char then return end
    
    local root = char:FindFirstChild("HumanoidRootPart")
    local hum = char:FindFirstChild("Humanoid")
    
    -- 1. FORCE WALKSPEED (Physics Step)
    if hum then hum.WalkSpeed = CONFIG.WalkSpeed end
    
    if not root then return end

    -- Update Visualizer
    if CONFIG.ShowRange then
        rangePart.CFrame = root.CFrame
    else
        rangePart.CFrame = CFrame.new(0, -1000, 0)
    end

    -- 2. TOOL VALIDATION
    local tool = char:FindFirstChildWhichIsA("Tool")
    -- Check for remote in Character OR Tool (Some games move it)
    local remote = char:FindFirstChild("SwordDamage") or (tool and tool:FindFirstChild("SwordDamage"))

    if not tool or not remote then
        label.Text = "STATUS: EQUIP WEAPON"
        label.TextColor3 = Color3.new(1, 0.5, 0)
        return
    end

    -- 3. SPATIAL QUERY (The "God" Detection)
    if tick() - lastAttack >= CONFIG.AttackSpeed then
        -- Don't detect ourselves
        overlapParams.FilterDescendantsInstances = {char, rangePart}
        
        -- Ask the engine for parts
        local parts = Workspace:GetPartBoundsInRadius(root.Position, CONFIG.Range, overlapParams)
        local hitList = {} -- Deduplication table
        local hitCount = 0

        for _, part in ipairs(parts) do
            local enemyModel = part.Parent
            local enemyHum = enemyModel:FindFirstChild("Humanoid")
            
            -- VALIDATION: Is it alive? Is it not us? Have we hit it yet this frame?
            if enemyHum and enemyHum.Health > 0 and enemyModel ~= char and not hitList[enemyHum] then
                
                -- Mark as hit so we don't spam the remote for LeftArm, RightArm, Head, etc.
                hitList[enemyHum] = true 
                hitCount = hitCount + 1

                -- FIRE REMOTE
                -- Args: target, tool, multi, combo, size, grip
                remote:FireServer(
                    enemyHum,
                    tool,
                    1,  -- Multiplier (Keep 1 to avoid kick)
                    10, -- Combo (Max power)
                    tool.Handle.Size,
                    tool.GripPos
                )
                
                -- DUMMY EXPLOIT (If applicable)
                if enemyModel:FindFirstChild("dummyScript") then
                    local dRemote = game.ReplicatedStorage:FindFirstChild("DummyEvent")
                    if dRemote then dRemote:FireServer(100, enemyHum) end
                end
            end
        end
        
        label.Text = "TARGETS LOCKED: " .. hitCount
        label.TextColor3 = Color3.new(1, 0, 0)
        lastAttack = tick()
    end
end)

-- Cleanup on script end
game.CoreGui.ChildRemoved:Connect(function(child)
    if child == sg then rangePart:Destroy() end
end)
