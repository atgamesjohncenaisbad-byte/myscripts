--[[
    UNIVERSAL ALPHA COMBAT SUITE
    Optimization: O(n) targeted scanning
    Reliability: Atomic Reference Validation (Bypasses reference breakage)
--]]

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local lp = Players.LocalPlayer

-- Master Settings
local _WS = 40
local _RANGE = 60
local _SPEED = 0.05 -- Attack interval
local _COMBO = 10
local _MULTI = 1 -- Keep at 1 to stay under the server's "Massive Damage" kick

local lastAttack = 0

-- UI for real-time status
local sg = Instance.new("ScreenGui", lp.PlayerGui)
sg.Name = "AlphaHUD"
sg.ResetOnSpawn = false
local frame = Instance.new("Frame", sg)
frame.Size = UDim2.new(0, 220, 0, 60)
frame.Position = UDim2.new(0, 10, 0.05, 0)
frame.BackgroundColor3 = Color3.new(0,0,0)
frame.BackgroundTransparency = 0.5

local status = Instance.new("TextLabel", frame)
status.Size = UDim2.new(1, 0, 1, 0)
status.TextColor3 = Color3.new(1, 1, 1)
status.Font = Enum.Font.Code
status.TextSize = 15
status.Text = "Initializing..."

-- THE ATOMIC CORE: Runs every frame
RunService.Stepped:Connect(function()
    local char = lp.Character
    if not char then 
        status.Text = "Waiting for Character..."
        return 
    end

    local hum = char:FindFirstChildOfClass("Humanoid")
    local root = char:FindFirstChild("HumanoidRootPart")
    
    -- 1. PERSISTENT WALKSPEED LOCK
    if hum then
        hum.WalkSpeed = _WS
    end

    -- 2. DYNAMIC TOOL & REMOTE VALIDATION
    local tool = char:FindFirstChildWhichIsA("Tool")
    local remote = char:FindFirstChild("SwordDamage") or (tool and tool:FindFirstChild("SwordDamage"))
    
    if not tool or not remote then
        status.Text = "IDLE: Equip a Weapon"
        status.TextColor3 = Color3.new(1, 0.5, 0)
        return
    end

    -- 3. TARGET SCANNING (The "Mobs " folder from your dump)
    local mobs = workspace:FindFirstChild("Mobs ")
    if not mobs then
        status.Text = "ERROR: Mobs folder missing"
        return
    end

    status.Text = "AURA ACTIVE | WS: ".._WS
    status.TextColor3 = Color3.new(0, 1, 0)

    -- 4. ATTACK TIMING
    if tick() - lastAttack >= _SPEED then
        -- We scan zones (subfolders) dynamically
        for _, zone in ipairs(mobs:GetChildren()) do
            for _, mob in ipairs(zone:GetChildren()) do
                local targetHum = mob:FindFirstChildOfClass("Humanoid")
                local targetRoot = mob:FindFirstChild("HumanoidRootPart")
                
                if targetHum and targetRoot and targetHum.Health > 0 then
                    local mag = (targetRoot.Position - root.Position).Magnitude
                    if mag <= _RANGE then
                        -- Direct Remote Call (Bypassing client swings/cooldowns)
                        -- Based on: target, tool, multi, combo, size, grip
                        remote:FireServer(
                            targetHum,
                            tool,
                            _MULTI,
                            _COMBO,
                            tool.Handle.Size,
                            tool.GripPos
                        )
                        
                        -- Specific logic for Dummies (found at line 82 of your dump)
                        if mob:FindFirstChild("dummyScript") then
                             local dRemote = game.ReplicatedStorage:FindFirstChild("DummyEvent")
                             if dRemote then dRemote:FireServer(100, targetHum) end
                        end
                    end
                end
            end
        end
        lastAttack = tick()
    end
end)

-- Ensure WalkSpeed stays locked if an internal script tries to override it
lp.CharacterAdded:Connect(function(newChar)
    local newHum = newChar:WaitForChild("Humanoid")
    newHum.WalkSpeed = _WS
end)

print("Alpha Suite v5: Foolproof logic engaged.")
